<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Home - ft_IaC Documentation</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/bootstrap-theme.min.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">ft_IaC Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="active">
                    <a href="index.html">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Module <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="module/project.html">Project</a>
                        </li>
                    
                        <li >
                            <a href="module/network.html">Network</a>
                        </li>
                    
                        <li >
                            <a href="module/database.html">Database</a>
                        </li>
                    
                        <li >
                            <a href="module/autoscaling.html">Autoscaling</a>
                        </li>
                    
                        <li >
                            <a href="module/loadbalancer.html">Load Balancer</a>
                        </li>
                    
                        <li >
                            <a href="module/monitoring.html">Monitoring</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="about.html">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                    <li class="disabled">
                        <a rel="next" >
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="module/project.html">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="row">
                    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
      
    
        <li class="main active"><a href="#welcome-to-ft_iac">Welcome to ft_iac</a></li>
        
            <li><a href="#infrastructure-as-code">Infrastructure-as-code</a></li>
        
            <li><a href="#our-project">Our project</a></li>
        
            <li><a href="#architecture">Architecture</a></li>
        
            <li><a href="#deployment">Deployment</a></li>
        
            <li><a href="#code-organization">Code organization</a></li>
        
            <li><a href="#development">Development</a></li>
        
    
    
    </ul>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="welcome-to-ft_iac">Welcome to ft_iac</h1>
<p>ft_iac is a school project aimed to discover the world of infrastructure-as-code.</p>
<p><br></p>
<h2 id="infrastructure-as-code">Infrastructure-as-code</h2>
<p><em>Or the return of config files</em></p>
<p>When creating server, with compute instance, databases, virtual network, on a Cloud Provider, the old way was to do all by hand. 
Facing the sisyphean effort, one could make a bunch of scripts, if an API was provided, to automate the process.
But these approach are error prone, slow and need a precise comprehension of the Cloud Provider internals.</p>
<p>Infrastructure-as-code is a paradigm where provisioning and deployment is done declaratively.</p>
<p>Instead of dozens of commands wrote manually by a user, scripts running commands step by step or a deployer creating instances one by one in the cloud provider web interface everything is declared inside a (or multiple) file.</p>
<p>This means we declare the state of what we want, and not how to get to this state.
We then use a tool (in our case, <a href="https://developer.hashicorp.com/terraform">Terraform</a>) which know the step to create and configure our instances, routers, etc.</p>
<p><br></p>
<h2 id="our-project">Our project</h2>
<p>For this project we choose Terraform, for it is the most common IaC tool used in professional world, and Google Cloud because it's free offer is very good for beginning and experimentation.</p>
<p><br></p>
<h2 id="architecture">Architecture</h2>
<p>We use a multi instance architecture with one database. Each instance is managed via a Group Instance Manager, and is behind a proxy and a load balancer.
The Group Instance Manager is used by an Autoscaler to scale the number of instance based of the current load.</p>
<p><img alt="infrastructure architecture" src="iac_arch-small.png" /></p>
<p><br></p>
<h2 id="deployment">Deployment</h2>
<p><br></p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Google Cloud account with billing enabled.</li>
<li><code>gcloud</code> CLI installed </li>
<li><code>gcloud</code> CLI authenticated (with <code>gcloud auth application-default login</code>)</li>
<li><code>terraform</code> installed</li>
</ul>
<p><br></p>
<h3 id="initialization">Initialization</h3>
<p>Initializes the working directory </p>
<pre><code class="language-bash">terraform init
</code></pre>
<p><br></p>
<h3 id="configure-variables">Configure Variables</h3>
<p>Copy the example variables file:</p>
<pre><code class="language-bash">cp terraform.tfvars.example terraform.tfvars
</code></pre>
<p>Fill with Google Cloud info:</p>
<ul>
<li>
<p>Your billing account: <code>billing_account</code></p>
</li>
<li>
<p>Your project name: <code>gcp_project_name</code></p>
</li>
</ul>
<p>Project related configuration:</p>
<ul>
<li>
<p>The deployment region: <code>gcp_region</code></p>
</li>
<li>
<p>The instance type: <code>machine_type</code></p>
</li>
<li>
<p>An email address for alerting: <code>alert_email</code></p>
</li>
</ul>
<p><br></p>
<h4 id="possibles-values">Possibles values</h4>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gcp_region</code></td>
<td>Deployment Region</td>
<td><code>US</code>, <code>Europe</code>, <code>Asia</code></td>
</tr>
<tr>
<td><code>machine_type</code></td>
<td>Instance Size</td>
<td><code>small</code>, <code>medium</code>, <code>large</code></td>
</tr>
</tbody>
</table>
<p><br></p>
<h3 id="deploy-and-destroy">Deploy and destroy</h3>
<p>Deployment and deletion is done via Terraform cli, for each creative/destructive command, you'll be asked to confirm.</p>
<p>Deploy configuration:</p>
<pre><code class="language-bash">terraform apply
</code></pre>
<p>The resource creation can take a good amount of time, like 15-20 min for a database.</p>
<p>See the current status with:</p>
<pre><code class="language-bash">terraform show
</code></pre>
<p>Destroy all resources with:</p>
<pre><code class="language-bash">terraform destroy
</code></pre>
<p>Be careful, <em>all resources</em> means the database too.</p>
<p><br></p>
<h2 id="code-organization">Code organization</h2>
<p>The <code>main.tf</code> is the entrypoint, it load all module and configure them.</p>
<ul>
<li><code>terraform.tfvars</code>: where to put your project env (API key, instance type..)</li>
<li><code>.terraform.lock.hcl</code>: file generated by terraform, used to lock infra config</li>
<li><code>terraform.tfstate{.backup}</code>: state file describing the stack state </li>
<li><code>module/</code>: the Terraform module</li>
<li><code>iac-doc/</code>: the project documentation</li>
</ul>
<p>Modules:
- <strong>autoscaling</strong>: manage compute instance (creation, configuration, scaling..)
- <strong>database</strong>: the SQL database for our instance
- <strong>loadbalancer</strong>: network entrypoint, with a proxy and a loadbalancer
- <strong>monitoring</strong>: alerting service
- <strong>network</strong>: the Virtual Private Cloud
- <strong>project</strong>: the Google Cloud Project, where all resource are created</p>
<p><br></p>
<h2 id="development">Development</h2>
<p><br></p>
<h3 id="cheatsheet">Cheatsheet</h3>
<p>Destroy only some resource with:</p>
<pre><code class="language-bash">terraform destroy -target module.module_name
</code></pre>
<p>Practically, it is used only to destroy the compute instance :</p>
<pre><code class="language-bash">terraform destroy -target module.autoscaling
</code></pre>
<p>For some errors when creation, Terraform will loose the track of some resource. These resources need then to be deleted manually, using  <code>gcloud</code>.
A simple way to clear everything is to delete the Google Cloud Project and delete the <code>terraform.tfstate{.backup}</code> file(s)</p>
<p><br></p>
<h3 id="providers">Providers</h3>
<p><a href="https://cloud.google.com/?hl=en">Google Cloud</a></p>
<p><a href="https://registry.terraform.io/providers/hashicorp/random/latest">HashiCorp</a></p></div>
                </div>
        </div>

    <hr>
    <footer class="container">
        
        <center>Documentation built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="http://kristopolous.github.io/BOOTSTRA.386">BOOTSTRA.386</a>.</center>
    </footer>
        <script src="search/main.js"></script>
    </body>
</html>