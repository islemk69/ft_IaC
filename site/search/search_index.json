{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Welcome to ft_iac ft_iac is a school project aimed to discover the world of infrastructure-as-code. Infrastructure-as-code Or the return of config files When creating server, with compute instance, databases, virtual network, on a Cloud Provider, the old way was to do all by hand. Facing the sisyphean effort, one could make a bunch of scripts, if an API was provided, to automate the process. But these approach are error prone, slow and need a precise comprehension of the Cloud Provider internals. Infrastructure-as-code is a paradigm where provisioning and deployment is done declaratively. Instead of dozens of commands wrote manually by a user, scripts running commands step by step or a deployer creating instances one by one in the cloud provider web interface everything is declared inside a (or multiple) file. This means we declare the state of what we want, and not how to get to this state. We then use a tool (in our case, Terraform ) which know the step to create and configure our instances, routers, etc. Our project For this project we choose Terraform, for it is the most common IaC tool used in professional world, and Google Cloud because it's free offer is very good for beginning and experimentation. Architecture We use a multi instance architecture with one database. Each instance is managed via a Group Instance Manager, and is behind a proxy and a load balancer. The Group Instance Manager is used by an Autoscaler to scale the number of instance based of the current load. Deployment Prerequisites Google Cloud account with billing enabled. gcloud CLI installed gcloud CLI authenticated (with gcloud auth application-default login ) terraform installed Initialization Initializes the working directory terraform init Configure Variables Copy the example variables file: cp terraform.tfvars.example terraform.tfvars Fill with Google Cloud info: Your billing account: billing_account Your project name: gcp_project_name Project related configuration: The deployment region: gcp_region The instance type: machine_type An email address for alerting: alert_email Possibles values gcp_region Deployment Region US , Europe , Asia machine_type Instance Size small , medium , large Deploy and destroy Deployment and deletion is done via Terraform cli, for each creative/destructive command, you'll be asked to confirm. Deploy configuration: terraform apply The resource creation can take a good amount of time, like 15-20 min for a database. See the current status with: terraform show Destroy all resources with: terraform destroy Be careful, all resources means the database too. Code organization The main.tf is the entrypoint, it load all module and configure them. terraform.tfvars : where to put your project env (API key, instance type..) .terraform.lock.hcl : file generated by terraform, used to lock infra config terraform.tfstate{.backup} : state file describing the stack state module/ : the Terraform module iac-doc/ : the project documentation Modules: - autoscaling : manage compute instance (creation, configuration, scaling..) - database : the SQL database for our instance - loadbalancer : network entrypoint, with a proxy and a loadbalancer - monitoring : alerting service - network : the Virtual Private Cloud - project : the Google Cloud Project, where all resource are created Development Cheatsheet Destroy only some resource with: terraform destroy -target module.module_name Practically, it is used only to destroy the compute instance : terraform destroy -target module.autoscaling For some errors when creation, Terraform will loose the track of some resource. These resources need then to be deleted manually, using gcloud . A simple way to clear everything is to delete the Google Cloud Project and delete the terraform.tfstate{.backup} file(s) Providers Google Cloud HashiCorp","title":"Home"},{"location":"index.html#welcome-to-ft_iac","text":"ft_iac is a school project aimed to discover the world of infrastructure-as-code.","title":"Welcome to ft_iac"},{"location":"index.html#infrastructure-as-code","text":"Or the return of config files When creating server, with compute instance, databases, virtual network, on a Cloud Provider, the old way was to do all by hand. Facing the sisyphean effort, one could make a bunch of scripts, if an API was provided, to automate the process. But these approach are error prone, slow and need a precise comprehension of the Cloud Provider internals. Infrastructure-as-code is a paradigm where provisioning and deployment is done declaratively. Instead of dozens of commands wrote manually by a user, scripts running commands step by step or a deployer creating instances one by one in the cloud provider web interface everything is declared inside a (or multiple) file. This means we declare the state of what we want, and not how to get to this state. We then use a tool (in our case, Terraform ) which know the step to create and configure our instances, routers, etc.","title":"Infrastructure-as-code"},{"location":"index.html#our-project","text":"For this project we choose Terraform, for it is the most common IaC tool used in professional world, and Google Cloud because it's free offer is very good for beginning and experimentation.","title":"Our project"},{"location":"index.html#architecture","text":"We use a multi instance architecture with one database. Each instance is managed via a Group Instance Manager, and is behind a proxy and a load balancer. The Group Instance Manager is used by an Autoscaler to scale the number of instance based of the current load.","title":"Architecture"},{"location":"index.html#deployment","text":"","title":"Deployment"},{"location":"index.html#prerequisites","text":"Google Cloud account with billing enabled. gcloud CLI installed gcloud CLI authenticated (with gcloud auth application-default login ) terraform installed","title":"Prerequisites"},{"location":"index.html#initialization","text":"Initializes the working directory terraform init","title":"Initialization"},{"location":"index.html#configure-variables","text":"Copy the example variables file: cp terraform.tfvars.example terraform.tfvars Fill with Google Cloud info: Your billing account: billing_account Your project name: gcp_project_name Project related configuration: The deployment region: gcp_region The instance type: machine_type An email address for alerting: alert_email","title":"Configure Variables"},{"location":"index.html#possibles-values","text":"gcp_region Deployment Region US , Europe , Asia machine_type Instance Size small , medium , large","title":"Possibles values"},{"location":"index.html#deploy-and-destroy","text":"Deployment and deletion is done via Terraform cli, for each creative/destructive command, you'll be asked to confirm. Deploy configuration: terraform apply The resource creation can take a good amount of time, like 15-20 min for a database. See the current status with: terraform show Destroy all resources with: terraform destroy Be careful, all resources means the database too.","title":"Deploy and destroy"},{"location":"index.html#code-organization","text":"The main.tf is the entrypoint, it load all module and configure them. terraform.tfvars : where to put your project env (API key, instance type..) .terraform.lock.hcl : file generated by terraform, used to lock infra config terraform.tfstate{.backup} : state file describing the stack state module/ : the Terraform module iac-doc/ : the project documentation Modules: - autoscaling : manage compute instance (creation, configuration, scaling..) - database : the SQL database for our instance - loadbalancer : network entrypoint, with a proxy and a loadbalancer - monitoring : alerting service - network : the Virtual Private Cloud - project : the Google Cloud Project, where all resource are created","title":"Code organization"},{"location":"index.html#development","text":"","title":"Development"},{"location":"index.html#cheatsheet","text":"Destroy only some resource with: terraform destroy -target module.module_name Practically, it is used only to destroy the compute instance : terraform destroy -target module.autoscaling For some errors when creation, Terraform will loose the track of some resource. These resources need then to be deleted manually, using gcloud . A simple way to clear everything is to delete the Google Cloud Project and delete the terraform.tfstate{.backup} file(s)","title":"Cheatsheet"},{"location":"index.html#providers","text":"Google Cloud HashiCorp","title":"Providers"},{"location":"about.html","text":"Hey hoy This is a simple documentation done for our school project, ft_iac. This doc is 100% IA-free and has a theme choosen with care! Build the doc cd iac-doc pip install -r requirements.txt mkdocs build Serve the doc (locally) mkdocs serve","title":"About"},{"location":"about.html#hey-hoy","text":"This is a simple documentation done for our school project, ft_iac. This doc is 100% IA-free and has a theme choosen with care!","title":"Hey hoy"},{"location":"about.html#build-the-doc","text":"cd iac-doc pip install -r requirements.txt mkdocs build","title":"Build the doc"},{"location":"about.html#serve-the-doc-locally","text":"mkdocs serve","title":"Serve the doc (locally)"},{"location":"module/autoscaling.html","text":"Autoscaling This Module manage the compute instance. It use an Autoscaler and a Group Instance Manager to create and configure instance based on the current needs. Required variables project_id : project id to attach all resources to project_name : name to compute the resource name from region : the deployment region machine_type : what type of instance to create vpc_id : the VPC ID subnet_id : the subnet ID db_host : database IP db_user : database user db_password : database password db_name : database name Resources app_template ( google_compute_instance_template ): an Instance Template used to create new instance, the Template is based on ubuntu-2204-lts and use a user_data script to install docker and start the app app_mig ( google_compute_region_instance_group_manager ): the Instance Group Manager, responsible to create new instance using the Template app_autoscaler ( google_compute_region_autoscaler ): the Autoscaler, adjusting the number of instance based on th current load","title":"Autoscaling"},{"location":"module/autoscaling.html#autoscaling","text":"This Module manage the compute instance. It use an Autoscaler and a Group Instance Manager to create and configure instance based on the current needs.","title":"Autoscaling"},{"location":"module/autoscaling.html#required-variables","text":"project_id : project id to attach all resources to project_name : name to compute the resource name from region : the deployment region machine_type : what type of instance to create vpc_id : the VPC ID subnet_id : the subnet ID db_host : database IP db_user : database user db_password : database password db_name : database name","title":"Required variables"},{"location":"module/autoscaling.html#resources","text":"app_template ( google_compute_instance_template ): an Instance Template used to create new instance, the Template is based on ubuntu-2204-lts and use a user_data script to install docker and start the app app_mig ( google_compute_region_instance_group_manager ): the Instance Group Manager, responsible to create new instance using the Template app_autoscaler ( google_compute_region_autoscaler ): the Autoscaler, adjusting the number of instance based on th current load","title":"Resources"},{"location":"module/database.html","text":"Database Provide a database for the app deployed on our compute instance. The database is configured with automatic backup. Required variables project_id : project id to attach all resources to project_name : name to compute the resource name from region : the deployment region vpc_id : the ID of our VPC Resources password ( random_password ): a generated random password for the database instance ( google_sql_database_instance ): our database instance database ( google_sql_database ): our SQL database inside our database instace users ( google_sql_user ): the database user, used by the app","title":"Database"},{"location":"module/database.html#database","text":"Provide a database for the app deployed on our compute instance. The database is configured with automatic backup.","title":"Database"},{"location":"module/database.html#required-variables","text":"project_id : project id to attach all resources to project_name : name to compute the resource name from region : the deployment region vpc_id : the ID of our VPC","title":"Required variables"},{"location":"module/database.html#resources","text":"password ( random_password ): a generated random password for the database instance ( google_sql_database_instance ): our database instance database ( google_sql_database ): our SQL database inside our database instace users ( google_sql_user ): the database user, used by the app","title":"Resources"},{"location":"module/loadbalancer.html","text":"Load Balancer This module allow external traffic and redirect it between our compute instance. Required variables project_id : project id to attach all resources to project_name : name to compute the resource name from domain_name : the domain to use as entrypoint instance_group : the instance group to redirect traffic to Resources hc ( google_compute_health_check ): the healthcheck to use for checking instances backend ( google_compute_backend_service ): the load balancer, targeting a backend, in our case it's our Instance Group Manager lb ( google_compute_url_map ): url map to route traffic from proxy to load balancer proxy ( google_compute_target_http_proxy ): a proxy sitting before the load balancer http ( google_compute_global_forwarding_rule ): a forwarding rule to accept HTTP request and forward them to proxy default ( google_compute_managed_ssl_certificate ): SLL certificate for HTTPS proxy ( google_compute_target_https_proxy ): a HTTPS proxy sitting before the load balancer https ( google_compute_global_forwarding_rule ): a forwarding rule to accept HTTPS request and forward them to proxy","title":"Load Balancer"},{"location":"module/loadbalancer.html#load-balancer","text":"This module allow external traffic and redirect it between our compute instance.","title":"Load Balancer"},{"location":"module/loadbalancer.html#required-variables","text":"project_id : project id to attach all resources to project_name : name to compute the resource name from domain_name : the domain to use as entrypoint instance_group : the instance group to redirect traffic to","title":"Required variables"},{"location":"module/loadbalancer.html#resources","text":"hc ( google_compute_health_check ): the healthcheck to use for checking instances backend ( google_compute_backend_service ): the load balancer, targeting a backend, in our case it's our Instance Group Manager lb ( google_compute_url_map ): url map to route traffic from proxy to load balancer proxy ( google_compute_target_http_proxy ): a proxy sitting before the load balancer http ( google_compute_global_forwarding_rule ): a forwarding rule to accept HTTP request and forward them to proxy default ( google_compute_managed_ssl_certificate ): SLL certificate for HTTPS proxy ( google_compute_target_https_proxy ): a HTTPS proxy sitting before the load balancer https ( google_compute_global_forwarding_rule ): a forwarding rule to accept HTTPS request and forward them to proxy","title":"Resources"},{"location":"module/monitoring.html","text":"Monitoring This module enable email alerts for monitoring the cloud status. Required variables project_id : project id to attach all resources to project_name : name to compute the resource name from alert_email : the email address to send alert Resources email ( google_monitoring_notification_channel ): a notification channel via email high_cpu ( google_monitoring_alert_policy ): an alert policy to trigger alert when compute instance CPU usage hit a threshold","title":"Monitoring"},{"location":"module/monitoring.html#monitoring","text":"This module enable email alerts for monitoring the cloud status.","title":"Monitoring"},{"location":"module/monitoring.html#required-variables","text":"project_id : project id to attach all resources to project_name : name to compute the resource name from alert_email : the email address to send alert","title":"Required variables"},{"location":"module/monitoring.html#resources","text":"email ( google_monitoring_notification_channel ): a notification channel via email high_cpu ( google_monitoring_alert_policy ): an alert policy to trigger alert when compute instance CPU usage hit a threshold","title":"Resources"},{"location":"module/network.html","text":"Network This module manage the creation of a Virtual Private Cloud and his sub-component. Required variables project_id : project id to attach all resources to project_name : name to compute the resource name from region : the selected region to deploy subnet_cidr : a CIDR range for subnet Resources vpc ( google_compute_network ): A Virtual Private Cloud, basically oour private network subnet ( google_compute_subnetwork ): a subnetwork for the compute instance router ( google_compute_router ): our VPC router nat ( google_compute_router_nat ): a NAT to allow compute instances to access the internet (for updates/installations) without exposing them allow_web ( google_compute_firewall ): Firewall allowing only http private_ip_address ( google_compute_global_address ): Private IP address used by the private VPC connection private_vpc_connection ( google_service_networking_connection ): a private VPC connection for our internal traffic","title":"Network"},{"location":"module/network.html#network","text":"This module manage the creation of a Virtual Private Cloud and his sub-component.","title":"Network"},{"location":"module/network.html#required-variables","text":"project_id : project id to attach all resources to project_name : name to compute the resource name from region : the selected region to deploy subnet_cidr : a CIDR range for subnet","title":"Required variables"},{"location":"module/network.html#resources","text":"vpc ( google_compute_network ): A Virtual Private Cloud, basically oour private network subnet ( google_compute_subnetwork ): a subnetwork for the compute instance router ( google_compute_router ): our VPC router nat ( google_compute_router_nat ): a NAT to allow compute instances to access the internet (for updates/installations) without exposing them allow_web ( google_compute_firewall ): Firewall allowing only http private_ip_address ( google_compute_global_address ): Private IP address used by the private VPC connection private_vpc_connection ( google_service_networking_connection ): a private VPC connection for our internal traffic","title":"Resources"},{"location":"module/project.html","text":"Project This module allow the creation of a Google Cloud Project, based on a name supplied by user. Required variables project_name : a name for the project, the project id is computed from billing_account : the Google Cloud billing account, needed for API activation Resources project_suffix ( random_id ): a generated id to create the project id project ( google_project ): the project which will encapsulate all our Google Cloud resources The following are google_project_service resources used for API activation compute_api : Compute API, manage compute instance networks_api : Networks API, manage networks domains_api : Domains API, manage domain name dns_api : DNS API, manage DNS Zone","title":"Project"},{"location":"module/project.html#project","text":"This module allow the creation of a Google Cloud Project, based on a name supplied by user.","title":"Project"},{"location":"module/project.html#required-variables","text":"project_name : a name for the project, the project id is computed from billing_account : the Google Cloud billing account, needed for API activation","title":"Required variables"},{"location":"module/project.html#resources","text":"project_suffix ( random_id ): a generated id to create the project id project ( google_project ): the project which will encapsulate all our Google Cloud resources The following are google_project_service resources used for API activation compute_api : Compute API, manage compute instance networks_api : Networks API, manage networks domains_api : Domains API, manage domain name dns_api : DNS API, manage DNS Zone","title":"Resources"}]}